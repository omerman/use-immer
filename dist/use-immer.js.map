{"version":3,"file":"use-immer.js","sources":["../src/index.ts"],"sourcesContent":["import produce, { Draft, nothing } from \"immer\";\nimport { useState, useReducer, useCallback, useMemo, Dispatch } from \"react\";\n\nexport type Reducer<S = any, A = any> = (\n  draftState: Draft<S>,\n  action: A\n) => void | (S extends undefined ? typeof nothing : S);\n\nexport type Updater<S> = (f: ((draft: Draft<S>) => void) | S) => Promise<S>;\n\nexport type ImmerHook<S> = [S, Updater<S>];\n\nexport function useImmer<S = any>(initialValue: S | (() => S)): ImmerHook<S>;\n\nexport function useImmer(initialValue: any) {\n  const [val, updateValue] = useState(initialValue);\n  return [\n    val,\n    useCallback((updater) => {\n      if (typeof updater === \"function\") {\n        let nextValue: any;\n        return new Promise((resolve) => {\n          updateValue((curr: any) => {\n            nextValue = produce(curr, updater);\n            resolve(nextValue);\n            return nextValue;\n          });\n        });\n      } else {\n        const nextValue = updater;\n        updateValue(nextValue);\n        return Promise.resolve(nextValue);\n      }\n    }, []),\n  ];\n}\n\nexport function useImmerReducer<S = any, A = any>(\n  reducer: Reducer<S, A>,\n  initialState: S,\n  initialAction?: (initial: any) => S\n): [S, Dispatch<A>];\nexport function useImmerReducer(\n  reducer: any,\n  initialState: any,\n  initialAction: any\n) {\n  const cachedReducer = useMemo(() => produce(reducer), [reducer]);\n  return useReducer(cachedReducer, initialState as any, initialAction);\n}\n"],"names":["initialValue","useState","updateValue","useCallback","updater","nextValue","Promise","resolve","curr","produce","reducer","initialState","initialAction","cachedReducer","useMemo","useReducer"],"mappings":"yHAcyBA,SACIC,WAASD,GAAxBE,OACZ,MAAO,MAELC,cAAY,SAACC,GAET,IAAIC,EADN,GAAuB,mBAAZD,EAET,WAAWE,QAAQ,SAACC,GAClBL,EAAY,SAACM,GAGX,OAFAH,EAAYI,EAAQD,EAAMJ,GAC1BG,EAAQF,GACDA,MAIX,IAAMA,EAAYD,EAElB,OADAF,EAAYG,GACLC,QAAQC,QAAQF,IAExB,uCAULK,EACAC,EACAC,GAEA,IAAMC,EAAgBC,UAAQ,kBAAML,EAAQC,IAAU,CAACA,IACvD,OAAOK,aAAWF,EAAeF,EAAqBC"}